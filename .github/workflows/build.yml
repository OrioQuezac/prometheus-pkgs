name: build
run-name: Build Artifacts
on: push
jobs:
  build-artifacts:
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repository to the runner
        uses: actions/checkout@v4
      - name: Build Prometheus Artifacts
        run: sudo ./build.sh all
      - name: Copy nfpm confs
        run: sudo cp nfpm/* _build/
      - name: Archive Prometheus Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: prometheus-artifacts
          path: _build
  nfpm:
    runs-on: ubuntu-latest
    needs: build-artifacts
    steps:
      - name: Download Prometheus Artifacts
        uses: actions/download-artifact@v3
        with:
          name: prometheus-artifacts
      - name: Create Prometheus RPM Package
        uses: docker://goreleaser/nfpm:latest
        with:
          args: package --config ../prometheus.yaml -p deb
        working-directory: _build/prometheus
